<app-toolbar [(title)]="pageTitle" [(subtitle)]="pageSubtitle" [(arrow)]="pageArrow" [(link)]="pageLink"></app-toolbar>
<div class="mapdetail">
  <h2 class="mat-display-1">Statistics</h2>
  <mat-card>
    <mat-card-content>
      <mat-tab-group class="demo-tab-group">
        <ng-template ngFor let-version [ngForOf]="versions" let-i="index">
          <mat-tab label="{{version}}">
            <div class="demo-tab-content">
              <table class="table table-hover">
                <thead>
                <tr class="header">
                  <th scope="col"></th>
                  <th scope="col"># played</th>
                  <th scope="col">Avg. duration</th>
                  <th scope="col">Avg. tickets team 1</th>
                  <th scope="col">Avg. tickets team 2</th>
                  <th scope="col"># wins team 1</th>
                  <th scope="col"># wins team 2</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td>{{pageSubtitle}}(excluding COOP)</td>
                  <td>{{levels[i]?.timesPlayed}}</td>
                  <td>{{levels[i]?.averageDuration.toFixed() | number}} min</td>
                  <td>{{levels[i]?.averageTicketsTeam1}}</td>
                  <td>{{levels[i]?.averageTicketsTeam2}}</td>
                  <td>{{levels[i]?.winsTeam1}} ({{levels[i]?.winsTeam1 / levels[i]?.timesPlayed * 100 | number}}%)</td>
                  <td>{{levels[i]?.winsTeam2}} ({{levels[i]?.winsTeam2 / levels[i]?.timesPlayed * 100 | number}}%)</td>
                </tr>
                <ng-template ngFor let-gamemode [ngForOf]="levels[i]?.gameModes" let-i="index">
                  <tr>
                    <td>&nbsp;<i class="material-icons">subdirectory_arrow_right</i>{{gamemode.name}}</td>
                    <td>{{gamemode.timesPlayed}}</td>
                    <td>{{gamemode.averageDuration.toFixed()}} min</td>
                    <td>{{gamemode.averageTicketsTeam1}}</td>
                    <td>{{gamemode.averageTicketsTeam2}}</td>
                    <td>{{gamemode.winsTeam1}} ({{gamemode.winsTeam1 / gamemode.timesPlayed * 100 | number}}%)</td>
                    <td>{{gamemode.winsTeam2}} ({{gamemode.winsTeam2 / gamemode.timesPlayed * 100 | number}}%)</td>
                  </tr>
                  <ng-template ngFor let-layer [ngForOf]="gamemode.layers" let-j="index">
                    <tr>
                      <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="material-icons">subdirectory_arrow_right</i>{{layer.name}}
                      </td>
                      <td>{{layer.timesPlayed}}</td>
                      <td>{{layer.averageDuration.toFixed()}} min</td>
                      <td>{{layer.averageTicketsTeam1}}</td>
                      <td>{{layer.averageTicketsTeam2}}</td>
                      <td>{{layer.winsTeam1}} ({{layer.winsTeam1 / layer.timesPlayed * 100 | number}}%)</td>
                      <td>{{layer.winsTeam2}} ({{layer.winsTeam2 / layer.timesPlayed * 100 | number}}%)</td>
                    </tr>
                    <ng-template *ngIf="gamemode.name == 'Advance & Secure'" ngFor let-route [ngForOf]="layer.routes"
                                 let-m="index">
                      <tr>
                        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="material-icons">subdirectory_arrow_right</i>{{route.id}}
                        </td>
                        <td>{{route.timesPlayed}}</td>
                        <td>{{route.averageDuration.toFixed()}} min</td>
                        <td>{{route.averageTicketsTeam1}}</td>
                        <td>{{route.averageTicketsTeam2}}</td>
                        <td>{{route.winsTeam1}} ({{route.winsTeam1 / route.timesPlayed * 100 | number}}%)</td>
                        <td>{{route.winsTeam2}} ({{route.winsTeam2 / route.timesPlayed * 100 | number}}%)</td>
                      </tr>
                    </ng-template>
                  </ng-template>
                </ng-template>
                </tbody>
              </table>
            </div>
          </mat-tab>
        </ng-template>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
  <h2 class="mat-display-1">Heatmaps</h2>
    <mat-form-field>
      <mat-select placeholder="Version" [(value)]="selectedversion">
        <ng-template ngFor let-version [ngForOf]="versions" let-i="index">
          <mat-option (click)="clickForm()" value={{i}}>{{version}}</mat-option>
        </ng-template>
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-select placeholder="GameMode" [(value)]="selectedgamemode">
        <mat-option (click)="clickForm()" value="none">None</mat-option>
        <ng-template ngFor let-gamemode [ngForOf]="levels[selectedversion]?.gameModes" let-j="index">
          <mat-option (click)="clickForm()" value={{j}}>{{gamemode?.name}}</mat-option>
        </ng-template>
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-select placeholder="Layer" [(value)]="selectedlayer">
        <mat-option (click)="clickForm()" value="none">None</mat-option>
        <ng-template ngFor let-layer [ngForOf]="levels[selectedversion]?.gameModes[selectedgamemode]?.layers" let-k="index">
          <mat-option (click)="clickForm()" value={{k}}>{{layer?.name}}</mat-option>
        </ng-template>
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-select placeholder="Route" [(value)]="selectedroute">
        <mat-option (click)="clickForm()" value="none">None</mat-option>
        <ng-template ngFor let-route [ngForOf]="levels[selectedversion]?.gameModes[selectedgamemode]?.layers[selectedlayer]?.routes" let-l="index">
          <mat-option (click)="clickForm()" value={{l}}>{{route?.id}}</mat-option>
        </ng-template>
      </mat-select>
    </mat-form-field>
    <h3 class="subheading-2">Locations</h3>
    <div class="heatmap" id="heatmap" [ngStyle]="{'background-image': 'url(' + link + ')'}"></div>
</div>
